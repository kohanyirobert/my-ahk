#SingleInstance, Force

SetTitleMatchMode, RegEx

Global FLStudioBehavior := "Jump to previous marker"
Global uTorrentDir := "D:\Seed"

Menu, FLStudio, Add, Jump to previous marker, FLStudioMenuHandler
Menu, FLStudio, Default, Jump to previous marker

Menu, uTorrent, Add, Seed, uTorrentMenuHandler
Menu, uTorrent, Add, Downloads, uTorrentMenuHandler
Menu, uTorrent, Default, Seed

Menu, Tray, DeleteAll
Menu, Tray, NoStandard
Menu, Tray, Add, Audacity, AudacityMenuHandler
Menu, Tray, Disable, Audacity
Menu, Tray, Add, FL Studio, :FLStudio
Menu, Tray, Add, uTorrent, :uTorrent
Menu, Tray, Add
Menu, Tray, Add, Exit, ExitMenuHandler

Return

#IfWinActive ahk_class wxWindowClassNR
#!^+9::
{
  Send, {Space down}{Space up}
}
#IfWinActive

#IfWinActive ahk_class TFruityLoopsMainForm
#!^+9::
{
  If (FLStudioBehavior = "Jump to previous marker")
  {
    Send, !{NumpadDiv}
  }
  Return
}
#IfWinActive

#IfWinActive ahk_class Torrent4823DF041B09
^9::
{
  Send, {AppsKey}
  Sleep, 100
  Send, a
  Sleep, 100
  Send, e
  Sleep, 1000
  Loop
  {
    Sleep, 1000
    IfWinActive, ahk_class #32770
    {
      Send, !d
      Sleep, 100
      Send, %uTorrentDir%
      Loop
      {
        Sleep, 100
        IfWinActive, ahk_class #32770
        {
          Send, {Enter}
          Continue
        }
        Break
      }
      Continue
    }
    Break
  }
  Return
}
#IfWinActive

AudacityMenuHandler:
{
  Return
}

FLStudioMenuHandler:
{
  FLStudioBehavior := A_ThisMenuItem
  Menu, FLStudio, Default, %A_ThisMenuItem%
  Return
}

uTorrentMenuHandler:
{
  If (A_ThisMenuItem = "Seed")
  {
    uTorrentDir := "D:\Seed"
  }
  Else If (A_ThisMenuItem = "Downloads")
  {
    uTorrentDir := "D:\Downloads"
  }
  Menu, uTorrent, Default, %A_ThisMenuItem%
  Return
}

ExitMenuHandler:
{
  ExitApp
}
